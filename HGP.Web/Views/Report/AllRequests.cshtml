@model HGP.Web.Models.Report.AllRequestsReportDataModel
@{
    ViewBag.Title = "All Requests";
    ViewBag.MainClass = "content_full_width";
    Layout = "~/Views/Shared/_PortalLayout.cshtml";
}

<!-- widget grid -->
<section id="widget-grid" class="">
    <!-- row -->
    <div class="row">
        <!-- NEW WIDGET START -->
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <table id="jqgrid"></table>
            <div id="pjqgrid"></div>
        </article>
        <!-- WIDGET END -->
    </div>
</section>

@section Scripts {
    <script type="text/javascript">
        var excelUrl = '@Url.RouteUrl("PortalRoute", new {action = "AllRequestsDataExcel", controller = "Report"})';

        $("#jqgrid").jqGrid({
            url: '@Url.RouteUrl("PortalRoute", new {action = "AllRequestsData", controller = "Report"})',
            datatype: "json",
            jsonReader: { root: "Assets" },
            loadonce: true,
            height: 'auto',
            colNames: ['Request Num', 'Request Status', 'Requestor Name', 'Requestor Phone', 'Requestor Email', 'Hit Number', 'Asset Status', 'Location', 'Client Id Number', 'Net Book Value', 'Request Date', 'Notes'],
            colModel: [
                {
                    name: 'RequestNum',
                    index: 'RequestNum',
                    sortable: true,
                },
                {
                    name: 'Status',
                    index: 'Status',
                    sortable: true,
                    width: '100px'
                },
                {
                    name: 'RequestorName',
                    index: 'RequestorName',
                    sortable: true,
                },
                {
                    name: 'RequestorPhone',
                    index: 'RequestorPhone',
                    sortable: true,
                },
                {
                    name: 'RequestorEmail',
                    index: 'RequestorEmail',
                    sortable: true,
                },
                {
                    name: 'HitNumbers',
                    index: 'HitNumbers',
                    sortable: true,
                },
                {
                    name: 'AssetStatus',
                    index: 'AssetStatus',
                    sortable: true,
                },
                {
                    name: 'Locations',
                    index: 'Locations',
                    sortable: true,
                },

                {
                     name: 'ClientIdNumbers',
                     index: 'ClientIdNumbers',
                     sortable: true,
                },
                {
                    name: 'NetBookValues',
                    index: 'NetBookValues',
                    sortable: true,
                },
                {
                    name: 'RequestDate',
                    index: 'RequestDate',
                    formatter: 'date',
                    formatoptions: { srcformat: "ISO8601Long", newformat: "m/d/Y h:i A" },
                    sortable: true,
                },
                {
                    name: 'Notes',
                    index: 'Notes',
                    sortable: false,
                }
            ],
            rowNum: 25,
            rowList: [25, 50, 100],
            pager: '#pjqgrid',
            sortname: 'id',
            toolbarfilter: true,
            viewrecords: true,
            sortorder: "asc",
            gridComplete: function() {

            },
            editurl: "dummy.html",
            caption: "All Requests Report",
            multiselect: true,
            autowidth: true,
            subGrid: true,
            subGridRowExpanded: function(subgridId, rowid) {
                var subgridTableId = subgridId + "_t";
                $("#" + subgridId).html("<table id='" + subgridTableId + "'></table>");
                $("#" + subgridTableId).jqGrid({
                    datatype: "local",
                    data: $(this).jqGrid("getLocalRow", rowid).AssetRequests,
                    colNames: ["Id", "HitNumber", "Title"],
                    colModel: [
                        { name: "Id", key: true },
                        { name: "HitNumber" },
                        { name: "Title", width: 130 }
                    ],
                    height: "100%",
                    rowNum: 10,
                    sortname: "HitNumber",
                    idPrefix: "s_" + rowid + "_"
                });
            }
        });


        $("#jqgrid").jqGrid('navGrid', "#pjqgrid", {
            edit: false,
            add: false,
            del: true
        });

        $("#jqgrid").jqGrid('inlineNav', "#pjqgrid");

        $("#jqgrid").jqGrid('navButtonAdd', '#pjqgrid', {
            caption: "Excel",
            buttonicon: "ui-icon-document",
            onClickButton: function() {
                jQuery("#jqgrid").jqGrid('excelExport', { "url": excelUrl });
            }
        });

        /* Add tooltips */
        $('.navtable .ui-pg-button').tooltip({
            container: 'body'
        });

        $("#m1").click(function() {
            var s;
            s = jQuery("#jqgrid").jqGrid('getGridParam', 'selarrrow');
            alert(s);
        });

        $("#m1s").click(function() {
            jQuery("#jqgrid").jqGrid('setSelection', "13");
        });

        // remove classes
        $(".ui-jqgrid").removeClass("ui-widget ui-widget-content");
        $(".ui-jqgrid-view").children().removeClass("ui-widget-header ui-state-default");
        $(".ui-jqgrid-labels, .ui-search-toolbar").children().removeClass("ui-state-default ui-th-column ui-th-ltr");
        $(".ui-jqgrid-pager").removeClass("ui-state-default");
        $(".ui-jqgrid").removeClass("ui-widget-content");

        // add classes
        $(".ui-jqgrid-htable").addClass("table table-bordered table-hover");
        $(".ui-jqgrid-btable").addClass("table table-bordered table-striped");

        $(".ui-pg-div").removeClass().addClass("btn btn-sm btn-primary");
        $(".ui-icon.ui-icon-plus").removeClass().addClass("fa fa-plus");
        $(".ui-icon.ui-icon-pencil").removeClass().addClass("fa fa-pencil");
        $(".ui-icon.ui-icon-trash").removeClass().addClass("fa fa-trash-o");
        $(".ui-icon.ui-icon-search").removeClass().addClass("fa fa-search");
        $(".ui-icon.ui-icon-refresh").removeClass().addClass("fa fa-refresh");
        $(".ui-icon.ui-icon-disk").removeClass().addClass("fa fa-save").parent(".btn-primary").removeClass("btn-primary").addClass("btn-success");
        $(".ui-icon.ui-icon-cancel").removeClass().addClass("fa fa-times").parent(".btn-primary").removeClass("btn-primary").addClass("btn-danger");
        $(".ui-icon.ui-icon-document").removeClass().addClass("fa fa-file-excel-o");
        $(".ui-icon.ui-icon-seek-prev").wrap("<div class='btn btn-sm btn-default'></div>");
        $(".ui-icon.ui-icon-seek-prev").removeClass().addClass("fa fa-backward");

        $(".ui-icon.ui-icon-seek-first").wrap("<div class='btn btn-sm btn-default'></div>");
        $(".ui-icon.ui-icon-seek-first").removeClass().addClass("fa fa-fast-backward");

        $(".ui-icon.ui-icon-seek-next").wrap("<div class='btn btn-sm btn-default'></div>");
        $(".ui-icon.ui-icon-seek-next").removeClass().addClass("fa fa-forward");

        $(".ui-icon.ui-icon-seek-end").wrap("<div class='btn btn-sm btn-default'></div>");
        $(".ui-icon.ui-icon-seek-end").removeClass().addClass("fa fa-fast-forward");

        $(window).on('resize.jqGrid', function() {
            $("#jqgrid").jqGrid('setGridWidth', $("#content").width());
        });


        $("#refresh_jqgrid").hide();
        $("#jqgrid_iladd").hide();
        $("#jqgrid_iledit").hide();
        $("#jqgrid_ilsave").hide();
        $("#jqgrid_ilcancel").hide();
        $("#del_jqgrid").hide();
    </script>
}